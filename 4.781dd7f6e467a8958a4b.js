(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{p7VI:function(t,e,i){"use strict";i.r(e),i.d(e,"routes",(function(){return C})),i.d(e,"RouteTetrisRoutingModule",(function(){return R}));var n=i("tyNb"),r=i("fXoL");class s{constructor(t,e){this.num=t,this.speed=e}}const o=["none","cyan","blue","orange","yellow","green","purple","red"],a=[[],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],c=["none","rgba(132, 255, 255)","rgba(132, 132, 255)","rgba(255, 195, 132)","rgba(255, 255, 132)","rgba(132, 255, 132)","rgba(255, 132, 255)","rgba(255, 132, 132)"],l=["none","rgba(0, 132, 132)","rgba(0, 0, 132)","rgba(132, 65, 0)","rgba(132, 132, 0)","rgba(0, 132, 0)","rgba(132, 0, 132)","rgba(132, 0, 0)"];let h=(()=>{class t{}return t.SINGLE=100,t.DOUBLE=300,t.TRIPLE=500,t.TETRIS=800,t.SOFT_DROP=1,t.HARD_DROP=2,t})();const d=[new s(0,800),new s(1,720),new s(2,630),new s(3,550),new s(4,470),new s(5,380),new s(6,300),new s(7,220),new s(8,130),new s(9,100),new s(10,80),new s(11,80),new s(12,80),new s(13,70),new s(14,70),new s(15,70),new s(16,50),new s(17,50),new s(18,50),new s(19,30),new s(20,30)];class p{constructor(t){this.ctx=t,this.spawn()}spawn(){const t=this.randomizeTetrominoType(o.length-1);this.shape=a[t],this.color=o[t],this.colorLighter=c[t],this.colorDarker=l[t],this.x=4===t?4:3,this.y=0}draw(){this.ctx&&this.shape&&(this.ctx.fillStyle=this.color,this.shape.forEach((t,e)=>{t.forEach((t,i)=>{if(t>0){this.ctx.fillRect(this.x+i,this.y+e,1,1);const t=this.x+i,n=this.y+e;this.ctx.fillRect(t,n,1,1),this.add3D(this.ctx,t,n)}})}))}drawNext(t){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=this.color,this.shape.forEach((e,i)=>{e.forEach((e,n)=>{if(e>0){t.fillRect(n,i,1,1);const e=n+.025,r=i+.025;t.fillRect(e,r,.975,.975),this.add3D(t,e,r)}})})}move(t){this.x=t.x,this.y=t.y,this.shape=t.shape}randomizeTetrominoType(t){return Math.floor(Math.random()*t+1)}add3D(t,e,i){t.fillStyle=this.colorDarker,t.fillRect(e+.9,i,.1,1),t.fillRect(e,i+.9,1,.1),t.fillRect(e+.65,i+.3,.05,.3),t.fillRect(e+.3,i+.6,.4,.05),t.fillStyle=this.colorLighter,t.fillRect(e+.3,i+.3,.05,.3),t.fillRect(e+.3,i+.3,.4,.05),t.fillRect(e,i,.05,1),t.fillRect(e,i,.1,.95),t.fillRect(e,i,1,.05),t.fillRect(e,i,.95,.1)}}let b=(()=>{class t{getEmptyBoard(){return Array.from({length:20},()=>Array(10).fill(0))}valid(t,e){return t.shape.every((i,n)=>i.every((i,r)=>{const s=t.x+r,o=t.y+n;return this.isEmpty(i)||this.insideWalls(s)&&this.aboveFloor(o)&&this.notOccupied(e,s,o)}))}isEmpty(t){return 0===t}insideWalls(t){return t>=0&&t<10}aboveFloor(t){return t<=20}notOccupied(t,e,i){return t[i]&&0===t[i][e]}rotate(t){const e=JSON.parse(JSON.stringify(t));for(let i=0;i<e.shape.length;++i)for(let t=0;t<i;++t)[e.shape[t][i],e.shape[i][t]]=[e.shape[i][t],e.shape[t][i]];return e.shape.forEach(t=>t.reverse()),e}getLinesClearedPoints(t,e){return(e+1)*(1===t?h.SINGLE:2===t?h.DOUBLE:3===t?h.TRIPLE:4===t?h.TETRIS:0)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.zb({token:t,factory:t.\u0275fac}),t})();class f{constructor(t,e){this.key=t,this.piece=e}}const g=["board"],x=["next"];let u=(()=>{class t{constructor(t,e){this.boardService=t,this.changeDetectorRef=e,this.moves=[new f("ArrowLeft",t=>Object.assign(Object.assign({},t),{x:t.x-1})),new f("ArrowRight",t=>Object.assign(Object.assign({},t),{x:t.x+1})),new f("ArrowDown",t=>Object.assign(Object.assign({},t),{y:t.y+1})),new f(" ",t=>Object.assign(Object.assign({},t),{y:t.y+1})),new f("ArrowUp",t=>this.boardService.rotate(t))]}keyEvent(t){"Escape"===t.key?this.gameOver():this.moves.find(e=>e.key===t.key)&&(t.preventDefault(),this.doSomethingByCode(t.key))}ngOnInit(){this.initBoard(),this.initNext(),this.resetGame()}doSomethingByCode(t){if(!this.piece)return;let e=this.moves.find(e=>e.key===t).piece(this.piece);if(" "===t)for(;this.boardService.valid(e,this.board);)this.points+=h.HARD_DROP,this.piece.move(e),e=this.moves.find(t=>"ArrowDown"===t.key).piece(this.piece);else this.boardService.valid(e,this.board)&&(this.piece.move(e),"ArrowDown"===t&&(this.points+=h.SOFT_DROP))}initBoard(){this.ctx=this.canvas.nativeElement.getContext("2d"),this.ctx&&(this.ctx.canvas.width=200,this.ctx.canvas.height=400,this.ctx.scale(20,20))}initNext(){this.ctxNext=this.canvasNext.nativeElement.getContext("2d"),this.ctxNext.canvas.width=60,this.ctxNext.canvas.height=60,this.ctxNext.scale(15,15)}getEmptyBoard(){return Array.from({length:20},()=>Array(10).fill(0))}play(){this.resetGame(),this.next=new p(this.ctx),this.piece=new p(this.ctx),this.next.drawNext(this.ctxNext),this.time.start=performance.now(),this.requestId&&cancelAnimationFrame(this.requestId),this.animate()}resetGame(){this.points=0,this.lines=0,this.level=1,this.board=this.getEmptyBoard(),this.time={start:0,elapsed:0,level:d.find(t=>t.num===this.level).speed},this.addOutlines()}animate(t=0){this.time.elapsed=t-this.time.start,this.time.elapsed>this.time.level&&(this.time.start=t,!this.drop())?this.gameOver():(this.draw(),this.requestId=requestAnimationFrame(this.animate.bind(this)))}draw(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.piece.draw(),this.drawBoard()}drop(){const t=this.moves.find(t=>"ArrowDown"===t.key).piece(this.piece);if(this.boardService.valid(t,this.board))this.piece.move(t);else{if(this.freeze(),this.clearLines(),0===this.piece.y)return!1;this.piece=this.next,this.next=new p(this.ctx),this.next.drawNext(this.ctxNext)}return!0}clearLines(){let t=0;this.board.forEach((e,i)=>{e.every(t=>0!==t)&&(t++,this.board.splice(i,1),this.board.unshift(Array(10).fill(0)))}),t>0&&(this.points+=this.boardService.getLinesClearedPoints(t,this.level),this.lines+=t,this.lines>=10&&(this.level++,this.lines-=10,this.time.level=d.find(t=>t.num===this.level).speed),this.changeDetectorRef.markForCheck())}freeze(){this.piece.shape.forEach((t,e)=>{t.forEach((t,i)=>{t>0&&(this.board[e+this.piece.y][i+this.piece.x]=t)})})}drawBoard(){this.board.forEach((t,e)=>{t.forEach((t,i)=>{t>0&&(this.ctx.fillStyle=o[t],this.ctx.fillRect(i,e,1,1),this.add3D(i,e,t))})}),this.addOutlines()}gameOver(){cancelAnimationFrame(this.requestId),this.ctx.fillStyle="black",this.ctx.fillRect(1,3,8,1.2),this.ctx.font="1px Arial",this.ctx.fillStyle="red",this.ctx.fillText("GAME OVER",1.8,4)}add3D(t,e,i){this.ctx.fillStyle=l[i],this.ctx.fillRect(t+.9,e,.1,1),this.ctx.fillRect(t,e+.9,1,.1),this.ctx.fillRect(t+.65,e+.3,.05,.3),this.ctx.fillRect(t+.3,e+.6,.4,.05),this.ctx.fillStyle=c[i],this.ctx.fillRect(t+.3,e+.3,.05,.3),this.ctx.fillRect(t+.3,e+.3,.4,.05),this.ctx.fillRect(t,e,.05,1),this.ctx.fillRect(t,e,.1,.95),this.ctx.fillRect(t,e,1,.05),this.ctx.fillRect(t,e,.95,.1)}addOutlines(){for(let t=1;t<10;t++)this.ctx.fillStyle="black",this.ctx.fillRect(t,0,.025,this.ctx.canvas.height);for(let t=1;t<20;t++)this.ctx.fillStyle="black",this.ctx.fillRect(0,t,this.ctx.canvas.width,.025)}}return t.\u0275fac=function(e){return new(e||t)(r.Db(b),r.Db(r.h))},t.\u0275cmp=r.xb({type:t,selectors:[["app-tetris-board"]],viewQuery:function(t,e){var i;1&t&&(r.Rb(g,!0),r.Rb(x,!0)),2&t&&(r.Nb(i=r.Mb())&&(e.canvas=i.first),r.Nb(i=r.Mb())&&(e.canvasNext=i.first))},hostBindings:function(t,e){1&t&&r.Lb("keydown",(function(t){return e.keyEvent(t)}),!1,r.Ob)},decls:32,vars:3,consts:[[1,"grid"],[1,"info"],[1,"btn",3,"click"],[1,"front"],[1,"canvas"],[1,"next"],["next",""],[1,"game-board"],["board",""],[1,"controllers"],[1,"hidden"],[1,"btn","top",3,"click"],[1,"hidden2"],[1,"btn","left",3,"click"],[1,"btn","bottom",3,"click"],[1,"btn","right",3,"click"],[1,"btn","space",3,"click"]],template:function(t,e){1&t&&(r.Gb(0,"div",0),r.Gb(1,"div",1),r.Gb(2,"div"),r.Gb(3,"h1"),r.Sb(4,"TETRIS"),r.Fb(),r.Gb(5,"p"),r.Sb(6),r.Fb(),r.Gb(7,"p"),r.Sb(8),r.Fb(),r.Gb(9,"p"),r.Sb(10),r.Fb(),r.Fb(),r.Gb(11,"button",2),r.Lb("click",(function(){return e.play()})),r.Gb(12,"span",3),r.Sb(13," Play "),r.Fb(),r.Fb(),r.Fb(),r.Gb(14,"div",4),r.Eb(15,"canvas",5,6),r.Eb(17,"canvas",7,8),r.Gb(19,"div",9),r.Eb(20,"button",10),r.Gb(21,"button",11),r.Lb("click",(function(){return e.doSomethingByCode("ArrowUp")})),r.Eb(22,"span",3),r.Fb(),r.Eb(23,"button",12),r.Gb(24,"button",13),r.Lb("click",(function(){return e.doSomethingByCode("ArrowLeft")})),r.Eb(25,"span",3),r.Fb(),r.Gb(26,"button",14),r.Lb("click",(function(){return e.doSomethingByCode("ArrowDown")})),r.Eb(27,"span",3),r.Fb(),r.Gb(28,"button",15),r.Lb("click",(function(){return e.doSomethingByCode("ArrowRight")})),r.Eb(29,"span",3),r.Fb(),r.Gb(30,"button",16),r.Lb("click",(function(){return e.doSomethingByCode(" ")})),r.Eb(31,"span",3),r.Fb(),r.Fb(),r.Fb(),r.Fb()),2&t&&(r.ub(6),r.Tb("Score: ",e.points,""),r.ub(2),r.Tb("Lines: ",e.lines,""),r.ub(2),r.Tb("Level: ",e.level,""))},styles:['.grid[_ngcontent-%COMP%]{width:300px;margin:30px auto 0;display:grid;grid-template-rows:auto 1fr}.info[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;margin-bottom:30px}.game-board[_ngcontent-%COMP%]{width:200px;margin:0 auto;border:2px solid}.next[_ngcontent-%COMP%]{width:70px;margin:0 auto}.canvas[_ngcontent-%COMP%]{display:grid;grid-template-rows:auto auto auto}.btn[_ngcontent-%COMP%]{max-width:300px;background:#a30036;border-radius:12px;border:none;padding:0;cursor:pointer;outline-offset:4px}.btn[_ngcontent-%COMP%], .front[_ngcontent-%COMP%]{box-sizing:border-box}.front[_ngcontent-%COMP%]{display:block;width:100%;padding:12px;border-radius:12px;font-size:1.25rem;background:#f0003c;color:#fff;transform:translateY(-6px)}.btn[_ngcontent-%COMP%]:active   .front[_ngcontent-%COMP%]{transform:translateY(-2px)}.controllers[_ngcontent-%COMP%]{width:225px;margin:10px auto;display:grid;grid-template-columns:repeat(3,70px);grid-template-rows:repeat(3,45px);grid-gap:5px;grid-template-areas:"hidden top hidden2" "left bottom right" "space space space"}.hidden[_ngcontent-%COMP%]{grid-area:hidden;opacity:0}.hidden2[_ngcontent-%COMP%]{grid-area:hidden2;opacity:0}.top[_ngcontent-%COMP%]{grid-area:top}.top[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]{position:relative;height:40px}.top[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]:after{content:"";position:absolute;top:15px;left:25px;width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:12px solid #fff}.left[_ngcontent-%COMP%]{grid-area:left}.left[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]{position:relative;height:40px}.left[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]:after{content:"";position:absolute;top:14px;left:27px;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent;border-right:12px solid #fff}.bottom[_ngcontent-%COMP%]{grid-area:bottom}.bottom[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]{position:relative;height:40px}.bottom[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]:after{content:"";position:absolute;top:15px;left:25px;width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:12px solid #fff}.right[_ngcontent-%COMP%]{grid-area:right}.right[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]{position:relative;height:40px}.right[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]:after{content:"";position:absolute;top:15px;left:27px;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent;border-left:12px solid #fff}.space[_ngcontent-%COMP%]{grid-area:space}.space[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]{height:40px}@media screen and (min-width:768px){.grid[_ngcontent-%COMP%]{grid-template-columns:320px 200px}.info[_ngcontent-%COMP%]{margin-bottom:0}.controllers[_ngcontent-%COMP%]{display:none}}'],changeDetection:0}),t})(),m=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.xb({type:t,selectors:[["app-tetris"]],decls:1,vars:0,template:function(t,e){1&t&&r.Eb(0,"app-tetris-board")},directives:[u],styles:[""],changeDetection:0}),t})(),w=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.xb({type:t,selectors:[["app-route-tetris"]],decls:1,vars:0,template:function(t,e){1&t&&r.Eb(0,"app-tetris")},directives:[m],styles:[""],changeDetection:0}),t})();var y=i("ofXK");let v=(()=>{class t{}return t.\u0275mod=r.Bb({type:t}),t.\u0275inj=r.Ab({factory:function(e){return new(e||t)},providers:[b],imports:[[y.b]]}),t})(),O=(()=>{class t{}return t.\u0275mod=r.Bb({type:t}),t.\u0275inj=r.Ab({factory:function(e){return new(e||t)},imports:[[y.b,v]]}),t})();const C=[{path:"",component:w},{path:"*",redirectTo:""}];let R=(()=>{class t{}return t.\u0275mod=r.Bb({type:t}),t.\u0275inj=r.Ab({factory:function(e){return new(e||t)},imports:[[O,n.a.forChild(C)]]}),t})()}}]);