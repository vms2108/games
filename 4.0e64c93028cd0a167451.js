(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{p7VI:function(t,e,i){"use strict";i.r(e),i.d(e,"routes",(function(){return O})),i.d(e,"RouteTetrisRoutingModule",(function(){return S}));var s=i("tyNb"),n=i("fXoL");class r{constructor(t,e){this.num=t,this.speed=e}}const a=["none","cyan","blue","orange","yellow","green","purple","red"],c=[[],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],o=["none","rgba(132, 255, 255)","rgba(132, 132, 255)","rgba(255, 195, 132)","rgba(255, 255, 132)","rgba(132, 255, 132)","rgba(255, 132, 255)","rgba(255, 132, 132)"],h=["none","rgba(0, 132, 132)","rgba(0, 0, 132)","rgba(132, 65, 0)","rgba(132, 132, 0)","rgba(0, 132, 0)","rgba(132, 0, 132)","rgba(132, 0, 0)"];let l=(()=>{class t{}return t.ESC=27,t.SPACE=32,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t})(),d=(()=>{class t{}return t.SINGLE=100,t.DOUBLE=300,t.TRIPLE=500,t.TETRIS=800,t.SOFT_DROP=1,t.HARD_DROP=2,t})();const p=[new r(0,800),new r(1,720),new r(2,630),new r(3,550),new r(4,470),new r(5,380),new r(6,300),new r(7,220),new r(8,130),new r(9,100),new r(10,80),new r(11,80),new r(12,80),new r(13,70),new r(14,70),new r(15,70),new r(16,50),new r(17,50),new r(18,50),new r(19,30),new r(20,30)];class b{constructor(t){this.ctx=t,this.spawn()}spawn(){const t=this.randomizeTetrominoType(a.length-1);this.shape=c[t],this.color=a[t],this.colorLighter=o[t],this.colorDarker=h[t],this.x=4===t?4:3,this.y=0}draw(){this.ctx&&this.shape&&(this.ctx.fillStyle=this.color,this.shape.forEach((t,e)=>{t.forEach((t,i)=>{if(t>0){this.ctx.fillRect(this.x+i,this.y+e,1,1);const t=this.x+i,s=this.y+e;this.ctx.fillRect(t,s,1,1),this.add3D(this.ctx,t,s)}})}))}drawNext(t){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=this.color,this.shape.forEach((e,i)=>{e.forEach((e,s)=>{if(e>0){t.fillRect(s,i,1,1);const e=s+.025,n=i+.025;t.fillRect(e,n,.975,.975),this.add3D(t,e,n)}})})}move(t){this.x=t.x,this.y=t.y,this.shape=t.shape}randomizeTetrominoType(t){return Math.floor(Math.random()*t+1)}add3D(t,e,i){t.fillStyle=this.colorDarker,t.fillRect(e+.9,i,.1,1),t.fillRect(e,i+.9,1,.1),t.fillRect(e+.65,i+.3,.05,.3),t.fillRect(e+.3,i+.6,.4,.05),t.fillStyle=this.colorLighter,t.fillRect(e+.3,i+.3,.05,.3),t.fillRect(e+.3,i+.3,.4,.05),t.fillRect(e,i,.05,1),t.fillRect(e,i,.1,.95),t.fillRect(e,i,1,.05),t.fillRect(e,i,.95,.1)}}let f=(()=>{class t{getEmptyBoard(){return Array.from({length:20},()=>Array(10).fill(0))}valid(t,e){return t.shape.every((i,s)=>i.every((i,n)=>{const r=t.x+n,a=t.y+s;return this.isEmpty(i)||this.insideWalls(r)&&this.aboveFloor(a)&&this.notOccupied(e,r,a)}))}isEmpty(t){return 0===t}insideWalls(t){return t>=0&&t<10}aboveFloor(t){return t<=20}notOccupied(t,e,i){return t[i]&&0===t[i][e]}rotate(t){const e=JSON.parse(JSON.stringify(t));for(let i=0;i<e.shape.length;++i)for(let t=0;t<i;++t)[e.shape[t][i],e.shape[i][t]]=[e.shape[i][t],e.shape[t][i]];return e.shape.forEach(t=>t.reverse()),e}getLinesClearedPoints(t,e){return(e+1)*(1===t?d.SINGLE:2===t?d.DOUBLE:3===t?d.TRIPLE:4===t?d.TETRIS:0)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=n.zb({token:t,factory:t.\u0275fac}),t})();class u{constructor(t,e){this.key=t,this.piece=e}}const x=["board"],y=["next"];let m=(()=>{class t{constructor(t,e){this.boardService=t,this.changeDetectorRef=e,this.moves=[new u(l.LEFT,t=>Object.assign(Object.assign({},t),{x:t.x-1})),new u(l.RIGHT,t=>Object.assign(Object.assign({},t),{x:t.x+1})),new u(l.DOWN,t=>Object.assign(Object.assign({},t),{y:t.y+1})),new u(l.SPACE,t=>Object.assign(Object.assign({},t),{y:t.y+1})),new u(l.UP,t=>this.boardService.rotate(t))]}keyEvent(t){if(t.keyCode===l.ESC)this.gameOver();else if(this.moves.find(e=>e.key===t.keyCode)){t.preventDefault();let e=this.moves.find(e=>e.key===t.keyCode).piece(this.piece);if(t.keyCode===l.SPACE)for(;this.boardService.valid(e,this.board);)this.points+=d.HARD_DROP,this.piece.move(e),e=this.moves.find(t=>t.key===l.DOWN).piece(this.piece);else this.boardService.valid(e,this.board)&&(this.piece.move(e),t.keyCode===l.DOWN&&(this.points+=d.SOFT_DROP))}}ngOnInit(){this.initBoard(),this.initNext(),this.resetGame()}initBoard(){this.ctx=this.canvas.nativeElement.getContext("2d"),this.ctx&&(this.ctx.canvas.width=250,this.ctx.canvas.height=500,this.ctx.scale(25,25))}initNext(){this.ctxNext=this.canvasNext.nativeElement.getContext("2d"),this.ctxNext.canvas.width=100,this.ctxNext.canvas.height=100,this.ctxNext.scale(25,25)}getEmptyBoard(){return Array.from({length:20},()=>Array(10).fill(0))}play(){this.resetGame(),this.next=new b(this.ctx),this.piece=new b(this.ctx),this.next.drawNext(this.ctxNext),this.time.start=performance.now(),this.requestId&&cancelAnimationFrame(this.requestId),this.animate()}resetGame(){this.points=0,this.lines=0,this.level=0,this.board=this.getEmptyBoard(),this.time={start:0,elapsed:0,level:p.find(t=>t.num===this.level).speed}}animate(t=0){this.time.elapsed=t-this.time.start,this.time.elapsed>this.time.level&&(this.time.start=t,!this.drop())?this.gameOver():(this.draw(),this.requestId=requestAnimationFrame(this.animate.bind(this)))}draw(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.piece.draw(),this.drawBoard()}drop(){const t=this.moves.find(t=>t.key===l.DOWN).piece(this.piece);if(this.boardService.valid(t,this.board))this.piece.move(t);else{if(this.freeze(),this.clearLines(),0===this.piece.y)return!1;this.piece=this.next,this.next=new b(this.ctx),this.next.drawNext(this.ctxNext)}return!0}clearLines(){let t=0;this.board.forEach((e,i)=>{e.every(t=>0!==t)&&(t++,this.board.splice(i,1),this.board.unshift(Array(10).fill(0)))}),t>0&&(this.points+=this.boardService.getLinesClearedPoints(t,this.level),this.lines+=t,this.lines>=10&&(this.level++,this.lines-=10,this.time.level=p.find(t=>t.num===this.level).speed),this.changeDetectorRef.markForCheck())}freeze(){this.piece.shape.forEach((t,e)=>{t.forEach((t,i)=>{t>0&&(this.board[e+this.piece.y][i+this.piece.x]=t)})})}drawBoard(){this.board.forEach((t,e)=>{t.forEach((t,i)=>{t>0&&(this.ctx.fillStyle=a[t],this.ctx.fillRect(i,e,1,1))})})}gameOver(){cancelAnimationFrame(this.requestId),this.ctx.fillStyle="black",this.ctx.fillRect(1,3,8,1.2),this.ctx.font="1px Arial",this.ctx.fillStyle="red",this.ctx.fillText("GAME OVER",1.8,4)}}return t.\u0275fac=function(e){return new(e||t)(n.Db(f),n.Db(n.h))},t.\u0275cmp=n.xb({type:t,selectors:[["app-tetris-board"]],viewQuery:function(t,e){var i;1&t&&(n.Rb(x,!0),n.Rb(y,!0)),2&t&&(n.Nb(i=n.Mb())&&(e.canvas=i.first),n.Nb(i=n.Mb())&&(e.canvasNext=i.first))},hostBindings:function(t,e){1&t&&n.Lb("keydown",(function(t){return e.keyEvent(t)}),!1,n.Ob)},decls:17,vars:3,consts:[[1,"grid"],[1,"game-board"],["board",""],[1,"right-column"],[1,"next"],["next",""],[1,"play-button",3,"click"]],template:function(t,e){1&t&&(n.Gb(0,"div",0),n.Eb(1,"canvas",1,2),n.Gb(3,"div",3),n.Gb(4,"div"),n.Gb(5,"h1"),n.Sb(6,"TETRIS"),n.Fb(),n.Gb(7,"p"),n.Sb(8),n.Fb(),n.Gb(9,"p"),n.Sb(10),n.Fb(),n.Gb(11,"p"),n.Sb(12),n.Fb(),n.Eb(13,"canvas",4,5),n.Fb(),n.Gb(15,"button",6),n.Lb("click",(function(){return e.play()})),n.Sb(16,"Play"),n.Fb(),n.Fb(),n.Fb()),2&t&&(n.ub(8),n.Tb("Score: ",e.points,""),n.ub(2),n.Tb("Lines: ",e.lines,""),n.ub(2),n.Tb("Level: ",e.level,""))},styles:[".grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:320px 200px}.right-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}.game-board[_ngcontent-%COMP%]{border:2px solid}.play-button[_ngcontent-%COMP%]{background-color:#4caf50;font-size:16px;padding:15px 30px;cursor:pointer}"],changeDetection:0}),t})(),v=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.xb({type:t,selectors:[["app-tetris"]],decls:2,vars:0,template:function(t,e){1&t&&(n.Eb(0,"app-tetris-board"),n.Sb(1,"\nHello"))},directives:[m],styles:[""],changeDetection:0}),t})(),g=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.xb({type:t,selectors:[["app-route-tetris"]],decls:1,vars:0,template:function(t,e){1&t&&n.Eb(0,"app-tetris")},directives:[v],styles:[""],changeDetection:0}),t})();var w=i("ofXK");let E=(()=>{class t{}return t.\u0275mod=n.Bb({type:t}),t.\u0275inj=n.Ab({factory:function(e){return new(e||t)},providers:[f],imports:[[w.b]]}),t})(),R=(()=>{class t{}return t.\u0275mod=n.Bb({type:t}),t.\u0275inj=n.Ab({factory:function(e){return new(e||t)},imports:[[w.b,E]]}),t})();const O=[{path:"",component:g},{path:"*",redirectTo:""}];let S=(()=>{class t{}return t.\u0275mod=n.Bb({type:t}),t.\u0275inj=n.Ab({factory:function(e){return new(e||t)},imports:[[R,s.a.forChild(O)]]}),t})()}}]);